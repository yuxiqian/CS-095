	.ORIG		x3000
	AND		R0, R0, #0
	AND		R1, R1, #0
	AND		R2, R2, #0
	AND		R3, R3, #0
	AND		R4, R4, #0
	AND		R5, R5, #0
	AND		R6, R6, #0
	AND		R7, R7, #0
AGAIN	LEA		R1, PROMPT
LOOP	LDR		R0, R1, #0
	ADD		R1, R1, #1
	STI		R0, DDR
	ADD		R0, R0, #0
	BRnp		LOOP
	LD		R1, START
	LD		R2, LENGTH
	LD		R3, NEWLINE
	LD		R4, ANTLINE
	LD		R5, INBUF

INPUT	TRAP		x20

	ADD		R7, R0, R3
	BRz		SEARCH

	LD		R6, ASCIIA
	ADD		R7, R0, R6
	BRz		NORMAL
	
	LD		R6, ASCIIB
	ADD		R7, R0, R6
	BRz		NORMAL	

	ADD		R0, R0, R3

	ADD		R0, R0, R2

	ADD		R0, R0, R1
	BRn		EXIT

	ADD		R0, R0, R3
	BRzp		EXIT
	
	BRnzp		CLEAN

CLEAN	ADD		R0, R0, R2
	ADD		R0, R0, R4
	BRnzp		NORMAL

NORMAL	STR		R0, R5, #0
	ADD		R5, R5, #1
	TRAP		x21
	BRnzp		INPUT


SEARCH	AND		R0, R0, #0
	STR		R0, R5, #0
	LD		R0, LINKER
LOOP5	LDR		R1, R0, #0
	BRz		FINAL
	ADD		R2, R1, #1
	LD		R3, INBUF

	LDR		R7, R2, #0
COMPARE	LDR		R6, R3, #0
	LDR		R4, R7, #0
	ADD		R5, R6, R4
	BRz		RESULT
	NOT		R5, R6
	ADD		R5, R5, #1
	ADD		R5, R5, R4
	BRnp		NEXT
	ADD		R3, R3, #1
	ADD		R7, R7, #1
	BRnzp		COMPARE

NEXT	LDR		R0, R0, #0
	BRnzp		LOOP5

FINAL	LDR		R6, R3, #0
	ADD		R7, R4, #0
	ADD		R5, R6, R7
	BRz		RESULT
	NOT		R5, R6
	ADD		R5, R5, #1
	ADD		R5, R5, R7
	BRnp		DEFAULT
	ADD		R3, R3, #1
	ADD		R4, R4, #1
	BRnzp		FINAL

RESULT	AND		R0, R0, #0
	ADD		R0, R0, #10
	STI		R0, DDR
	LDR		R1, R1, #2
LOOP4	LDR		R0, R1, #0
	ADD		R1, R1, #1
	STI		R0, DDR
	ADD		R0, R0, #0
	BRnp		LOOP4
	TRAP		x25

DEFAULT	LEA		R1, DFTPRM
LOOP3	LDR		R0, R1, #0
	ADD		R1, R1, #1
	STI		R0, DDR
	ADD		R0, R0, #0
	BRnp		LOOP3
	TRAP		x25


EXIT	LEA		R1, ERROR
LOOP2	LDR		R0, R1, #0
	ADD		R1, R1, #1
	STI		R0, DDR
	ADD		R0, R0, #0
	BRnp		LOOP2
	TRAP		x25


DSR	.FILL		xFE04
DDR	.FILL		xFE06
KBSR	.FILL		xFE00
KBDR	.FILL		xFE02

INBUF	.FILL		x2FF0		
LINKER	.FILL		x3300
START	.FILL		xFFD0	; - x0030
LENGTH	.FILL		x000A
NEWLINE	.FILL		xFFF6	; - x000A
ANTLINE	.FILL		x0030
ASCIIA	.FILL		xFFBF
ASCIIB	.FILL		xFFBE

ENDLINE	.STRINGZ	"\n"
DFTPRM	.STRINGZ	"\nNo Entry"
PROMPT	.STRINGZ	"Type a room number and press Enter: "
ERROR	.STRINGZ	"\nInvalid input format."
	.END